<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8 /><meta name=viewport content="width=device-width, initial-scale=1.0" /><title>VB.NET实现的Steam各类用户ID转换 - 戈登走過去的博客</title><link rel=icon href=/favicon.ico /><link type=text/css rel=stylesheet href=/main.css /><link type=text/css rel=stylesheet href=/vs.min.css /><link rel=alternate type=application/atom+xml title="戈登走過去的博客 - Atom" href=/atom.xml /><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "caac368e0b344c98a3c1d683087fbb86"}'></script></head><body><main><header><div id=headerBar>戈登走過去的博客</div><nav id=headerNav><a href=/>首页</a> <a href=/rsss>RSS</a> <a href=/about>关于</a> <a href=/search>搜索</a> <a href=https://shimo.im/forms/WgWqrRWWjTYRDqCR/fill>留言</a></nav></header><div class=pageSection><div class=sectionTitleBox><span class=sectionTitle></span></div></div><article><h1>VB.NET实现的Steam各类用户ID转换</h1><div class=articleContent><time datetime="2021-05-29 15:20:06.001+0800" class=articleDate>本文发布于公元 2021 年 05 月 29 日 15:20:06</time><p>以前傻乎乎地用 BitArray 来实现，今天终于学会玩位移了。<br /> 这个戈登就是逊啦！</p><p>V社官方开发者维基的关于 steamid 的解释： <a href=https://developer.valvesoftware.com/wiki/SteamID:zh-cn>点我</a></p><p>GMod lua api 里面的 <a href=https://wiki.facepunch.com/gmod/Player:SteamID>Player:SteamID()</a> 返回的id32的 universe 一律为0，可是按照理论应该是1才对。所以下面的代码里主要体现的是玩家id的转换，不包括其他id（比如群组）的转换。</p><pre><code class=language-vb>''' &lt;summary>
''' 把 steamid32 转换为 id64，会忽视 id32 里的 universe，一律视为1
''' &lt;/summary>
Function GetSteamID64FromID32(id As String) As Long
    Dim m As Match = Regex.Match(id, "STEAM_([0-9]):([0-9]):([0-9]+)")
    If m.Success Then
        Dim lastBit As Byte = If(m.Result("$2").Equals("1"), 1, 0)
        Dim num As Integer = CInt(m.Result("$3"))
        num &lt;&lt;= 1
        Dim out As Long = 1
        out &lt;&lt;= 4
        out += 1
        out &lt;&lt;= 20
        out += 1
        out &lt;&lt;= 32
        out += num + lastBit
        Return out
    End If
    Throw New ArgumentException("This is not a steamid32.")
End Function

''' &lt;summary>
''' 把 steamid3 转换为 id64，一律转换为 U:1
''' &lt;/summary>
Function GetSteamID64FromID3(id As String) As Long
    Dim m As Match = Regex.Match(id, "U:1:([0-9]+)")
    If m.Success Then
        Dim num = CLng(m.Result("$1"))
        Dim out As Long = 1
        out &lt;&lt;= 4
        out += 1
        out &lt;&lt;= 20
        out += 1
        out &lt;&lt;= 32
        out += num
        Return out
    End If
    Throw New ArgumentException("This is not a steamid3.")
End Function

''' &lt;summary>
''' 把 steamid64 转换为 steamid32
''' &lt;/summary>
Function GetSteamID32FromID64(id As Long) As String
    Dim universe = id >> 56
    Dim uid As ULong = CULng(id)
    Dim lastBit = uid &lt;&lt; 63 >> 63
    Dim num = id &lt;&lt; 32 >> 33
    Dim str = $"STEAM_{universe}:{lastBit}:{num}"
    Return str
End Function

''' &lt;summary>
''' 把 steamid64 转换为 steamid3，一律转换为 U:1
''' &lt;/summary>
Function GetSteamID3FromID64(id As Long) As String
    Dim num = id &lt;&lt; 32 >> 32
    Dim str = $"[U:1:{num}]"
    Return str
End Function

</code></pre></div></article></main><script src=/main.js></script><script src=/highlight.min.js></script><script>(function(){let n=document.body.querySelectorAll("pre code");for(let t=0;t<n.length;t++){let i=n[t];hljs.highlightBlock(i)}})()</script></body></html>