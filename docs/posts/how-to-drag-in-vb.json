{"Title":"在 VB.NET 里进行文件拖入和拖出的方法","Time":1515168000000,"Content":"<span class='winformComment'>'在 VB.NET 里进行文件拖入和拖出的方法<br>'本文发布于 2018年 01月 06日<br>'本网站所有文章，除非另外注明，否则皆采用 <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh' target='_blank'>CC BY-NC-SA 4.0</a> 进行许可。 </span><br><p>写此文的实际目的：我自己会忘记，给我自己用的。（误）<br />\n不得不说， Drag 真的是世界上最舒服的操作了，没什么比文件拽来拽去更省事的了。<br />\n之前看了一些讲解这个方面的文章，然后觉得都神了，简单的东西都给他们说的这么复杂。（害我当初也学了老久）<br />\n注意：我用的是 .NET Framework Winform。</p>\n<hr />\n<p>下面用例子先说明怎么拖入文件：<br />\n假设我需要把一排的文件拖入到一个列表里。<br />\n新增一个 ListBox 来放文件，我给起名叫 LB，然后把 AllowDrop 属性开成 True，这样才能让东西被拖进来。<br />\n<img src=\"https://s1.ax1x.com/2018/01/06/pELw5t.png\" alt=\"\" /></p>\n<p>然后在代码里新增需要两个事件，分别对应拖放操作的鼠标移动进来和鼠标松开（东西丢下）。<br />\n鼠标移动进来就是 DragEnter 事件，这里需要设置的是他的拖放效果。</p>\n<pre><code class=\"language-VB\">    Private Sub LB_DragEnter(sender As Object, e As DragEventArgs) Handles LB.DragEnter\n        e.Effect = DragDropEffects.Link '使用 link 就能获得拖入的东西的位置（目录）\n    End Sub\n</code></pre>\n<p>然后要设置他的东西丢下事件，也就是 DragDrop 事件。因为拖入的文件可能不止一个，所以需要把拖入的文件信息全部过一遍。</p>\n<pre><code class=\"language-VB\">    Private Sub LB_DragDrop(sender As Object, e As DragEventArgs) Handles LB.DragDrop\n        For Each i As String In e.Data.GetData(DataFormats.FileDrop)  '你拽入的每个东西\n            LB.Items.Add(i)\t'把每个东西添加到列表里\n        Next\n    End Sub\n</code></pre>\n<p>如果你想过滤一些文件，只要对文件链接这个字符串进行过滤就行了，<br />\n如果想一拖入就读取文件的信息的话，也和 DragDrop 写在一起就是了。<br />\n实际效果：<br />\n<img src=\"https://s1.ax1x.com/2018/01/06/pEXW90.gif\" alt=\"\" /></p>\n<hr />\n<p>下面再来一个例子说明怎么拖出文件：<br />\n假设我需要把一个文本框里的信息直接拖出来变成 a.txt 。<br />\n首先来一个文本框，依然需要 AllowDrop = True 。<br />\n这里我用一个 RichTextBox ，起名叫 RR 好了。<br />\n<img src=\"https://s1.ax1x.com/2018/01/06/pEjCEd.png\" alt=\"\" /><br />\n什么？没有 AllowDrop ，我也很好奇为什么 RichTextBox 没有这个属性，这个直接在代码里写成 True 就是了。<br />\n<img src=\"https://s1.ax1x.com/2018/01/06/pEji4I.png\" alt=\"\" /><br />\n拖出和拖入不一样，拖入的本质是提取文件的位置为字符串，而拖出的本质是复制存在的文件到目的地，并不是让程序直接在目的地直接创造文件。<br />\n我们怎么拖出呢？我们直接从文本框里拖吧！省事！<br />\n给文本框加一个 MouseDown 事件，让鼠标按住的时候可以拖放。</p>\n<pre><code class=\"language-VB\">    Private Sub RR_MouseDown(sender As Object, e As MouseEventArgs) Handles RR.MouseDown\n        '必须定义一个数组存储要复制的文件列表，这里就一个文件，所以为0\n        Dim s(0) As String\n        s(0) = &quot;a.txt&quot;\n        '把 RR 的文本写到 a.txt 文件中\n        File.WriteAllText(s(0), RR.Text)\n        '下面就是开始拖放啦，需要一个新的 DataObject 物件，然后写入刚刚的 s 数组，以复制的形式拖放到外面。\n        RR.DoDragDrop(New DataObject(DataFormats.FileDrop, s), DragDropEffects.Copy)\n        '把生成的多余文件给删除了\n        File.Delete(s(0))\n    End Sub\n</code></pre>\n<p>实际效果：<br />\n<img src=\"https://s1.ax1x.com/2018/01/06/pExOCn.gif\" alt=\"\" /><br />\n当然，实际上是不鼓励你直接用一个文本框来拖拉的，因为那样的话你文本的选择也是个难题了。</p>\n<p>建议不要把拖入和拖出做在一起，要么加个去重的功能，否则你就等着看鼠标点一下自己拖一份复制给自己吧。<br />\n<img src=\"https://s1.ax1x.com/2018/01/06/pV94iQ.gif\" alt=\"\" /></p>"}